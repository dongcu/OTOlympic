<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gym.mappers.profile">

	<!-- 현재 예약 내역 개수 -->
	<select id="getMyReserveCnt" resultType="_int">
		select count(a.rv_num) from
			admin_reservation a
		join reservation r
			on a.rv_num = r.rv_num
		where r.userid = #{userid} and a.rv_date > now()
	</select>
	
	<!-- 현재 예약 목록 -->
	<select id="getMyReserve" resultType="com.gym.domain.ReservationVO">
		select * from
			admin_reservation a
		join reservation r
			on a.rv_num = r.rv_num
		where r.userid = #{userid} and a.rv_date > now()
			order by rv_date desc
			limit #{displayPost}, #{postNum}
	</select>
	
	<!-- 예약 취소 -->
	<delete id="my_reserve_delete">
		delete from reservation
			where rv_num = #{rv_num}
	</delete>

	<!-- 과거 예약 내역 개수 -->
	<select id="getMyReservePastCnt" resultType="_int">
		select count(a.rv_num) from
			admin_reservation a
		join reservation r
			on a.rv_num = r.rv_num
		<if test = 'date_list.equals("all_period")'>
			where r.userid = #{userid} and a.rv_date > now()
		</if>
		<if test = 'date_list.equals("1_month")'>
			where r.userid = #{userid} and a.rv_date > now() and a.rv_date = #{pastDate}
		</if>
		<if test = 'date_list.equals("3_months")'>
			where r.userid = #{userid} and a.rv_date > now() and a.rv_date = #{pastDate}
		</if>
		<if test = 'date_list.equals("6_months")'>
			where r.userid = #{userid} and a.rv_date > now() and a.rv_date = #{pastDate}
		</if>
		<if test = 'date_list.equals("12_months")'>
			where r.userid = #{userid} and a.rv_date > now() and a.rv_date = #{pastDate}
		</if>
		<if test = 'lecture_list.equals("all_lecture")'></if>
		<if test = 'lecture_list.equals("zumba")'>
			and a.rv_title = '줌바'
		</if>
		<if test = 'lecture_list.equals("yoga")'>
			and a.rv_title = '요가'
		</if>
		<if test = 'lecture_list.equals("dietdance")'>
			and a.rv_title = '다이어트댄스'
		</if>
		<if test = 'lecture_list.equals("pilates")'>
			and a.rv_title = '필라테스'
		</if>
		<if test = 'lecture_list.equals("aerobics")'>
			and a.rv_title = '에어로빅'
		</if>
		<if test = 'lecture_list.equals("spinning")'>
			and a.rv_title = '스피닝'
		</if>
	</select>
	
	<!-- 과거 예약 목록 -->
	<select id="getMyReservePast" resultType="com.gym.domain.ReservationVO">
		select * from
			admin_reservation a
		join reservation r
			on a.rv_num = r.rv_num
		<if test = 'date_list.equals("all_period")'>
			where r.userid = #{userid} and a.rv_date > now()
		</if>
		<if test = 'date_list.equals("1_month")'>
			where r.userid = #{userid} and a.rv_date > now() and a.rv_date = #{pastDate}
		</if>
		<if test = 'date_list.equals("3_months")'>
			where r.userid = #{userid} and a.rv_date > now() and a.rv_date = #{pastDate}
		</if>
		<if test = 'date_list.equals("6_months")'>
			where r.userid = #{userid} and a.rv_date > now() and a.rv_date = #{pastDate}
		</if>
		<if test = 'date_list.equals("12_months")'>
			where r.userid = #{userid} and a.rv_date > now() and a.rv_date = #{pastDate}
		</if>
		<if test = 'lecture_list.equals("all_lecture")'></if>
		<if test = 'lecture_list.equals("zumba")'>
			and a.rv_title = '줌바'
		</if>
		<if test = 'lecture_list.equals("yoga")'>
			and a.rv_title = '요가'
		</if>
		<if test = 'lecture_list.equals("dietdance")'>
			and a.rv_title = '다이어트댄스'
		</if>
		<if test = 'lecture_list.equals("pilates")'>
			and a.rv_title = '필라테스'
		</if>
		<if test = 'lecture_list.equals("aerobics")'>
			and a.rv_title = '에어로빅'
		</if>
		<if test = 'lecture_list.equals("spinning")'>
			and a.rv_title = '스피닝'
		</if>
			order by rv_date desc
			limit #{displayPost}, #{postNum}
	</select>
	


	<!-- 마이페이지(자게) 게시글 총 개수 -->
	<select id="getMyFreeCnt" resultType="_int">
		select count(b_num) from
			f_board where b_writer = #{b_writer}
	</select>

	<!-- 마이페이지(자게) 게시글 목록 -->
	<select id="getMyFreeList"
		resultType="com.gym.domain.FreeBoardVO">
		select *
			from f_board
		where b_writer = #{b_writer}
			order by b_num desc
			limit #{displayPost}, #{postNum}
	</select>

	<!-- 마이페이지(자게) 게시글 조회 -->
	<select id="getMyFreeDetail" parameterType="_int" resultType="com.gym.domain.FreeBoardVO">
		select * from f_board
		where b_num = #{b_num}
	</select>

	<!-- 마이페이지(자게) 게시글 삭제 -->
	<delete id="myFreeDelete">
		delete from f_board
		where b_num = #{b_num}
	</delete>

	<!-- 마이페이지(자게) 게시글 일괄 삭제 -->
	<delete id="myFreeDeleteAll">
		delete from f_board
		where b_writer = #{b_writer}
	</delete>

	<!-- 마이페이지(자게) 댓글 총 개수 -->
	<select id="getMyFreeRepCnt" resultType="_int">
		select count(c_num) from
		f_comment where c_writer = #{c_writer}
	</select>
	
	<!-- 마이페이지(자게) 댓글 목록 -->
	<select id="getMyFreeRepList" resultType="com.gym.domain.ReplyVO">
		select *
		from f_board b
		join f_comment c
		on b.b_num = c.b_num
		where c_writer = #{c_writer}
		order by c_date desc
		limit #{displayPost}, #{postNum}
	</select>

	<!-- 마이페이지(자게) 댓글 삭제 -->
	<delete id="myFreeRepDelete">
		delete from f_comment
		where c_num = #{c_num}
	</delete>

	<!-- 마이페이지(자게) 댓글 일괄 삭제 -->
	<delete id="myFreeRepDeleteAll">
		delete from f_comment
		where c_writer = #{c_writer}
	</delete>

</mapper>
